<div align="center">
  <img height="120x" src="https://uploads-ssl.webflow.com/611580035ad59b20437eb024/616f97a42f5637c4517d0193_Logo%20(1)%20(1).png" />

  <h1 style="margin-top:20px;">Keeper Bots for Drift Protocol v2</h1>

  <p>
    <a href="https://docs.drift.trade/tutorial-keeper-bots"><img alt="Docs" src="https://img.shields.io/badge/docs-tutorials-blueviolet" /></a>
    <a href="https://discord.com/channels/849494028176588802/878700556904980500"><img alt="Discord Chat" src="https://img.shields.io/discord/889577356681945098?color=blueviolet" /></a>
    <a href="https://opensource.org/licenses/Apache-2.0"><img alt="License" src="https://img.shields.io/github/license/project-serum/anchor?color=blueviolet" /></a>
  </p>
</div>

This fork has a few improvements over the original drift [keeper-bots-v2](https://github.com/drift-labs/keeper-bots-v2) relating to pricing, monitoring, and other operations. The improvements are detailed below. 

### Pricing and Hedging
- Rather than filling every jit auction with the auction start price use the mid price direct from the oracle. Often this is a significant difference even though the auction start price is also the oracle price. 
- Checking if the oracle is active and not erroring (would lead to auctions being filled at bad prices)
- If funding rate for a position is greater than the # orders filled * the maker rebate (1.2bps) set to close
- There is a chance that an order from the dlob is heard out of order and unable to be processed initially, added in checks to see if the failed submission of an order is still in the dlob and will submit to fill again 
- While running this bot you do not want to take on to much delta exposure. When `MAX_POSITION_EXPOSURE` (default 10% collateral) is reached all positions will be set to reduce only mode. Capping the bots delta exposure is important but also limits the bot to filling jit auctions with only ~10% of it's collateral before it only participates in orders that reduce its exposure. Now when `MAX_POSITION_EXPOSURE` is reached, the delta will be hedged on [01](https://01.exchange) allowing the bot to continue filling **all** orders.

### Monitoring and Logging
- Dashboards for monitoring orders and pnl, along with logs, and hardware statistics
- Logging with Loki

### Custody
- Implementation of Vault as a key-value store with the experimental additions of a plugin 

# Setting up
## Setup Environment
```shell
cp .env.example .env
```

Update values in `.env` accordingly

`KEEPER_PRIVATE_KEY`: can be a number array (as in example), or a path to a `keypair.json` as generated by `solana-keygen`. The address of this key requires SOL since it will be the signing authority of all transactions sent by this bot.

## Initialize User

A `ClearingHouseUser` must be created before interacting with the `ClearingHouse` program.

```shell
yarn run dev --init-user
```

## Depositing Collateral

Some bots (i.e. trading, liquidator and JIT makers) require collateral in order to keep positions open, a helper function is included to help with depositing collateral.
A user must be initialized first before collateral may be deposited.

```shell
# deposit 10,000 USDC
yarn run dev --force-deposit 10000
```

# Run Bots

By default, some [Prometheus](https://prometheus.io/) metrics are exposed on `localhost:9464/metrics`.

## Run Filler Bot
```shell
yarn
yarn run dev:filler
```

## Run Trigger Bot
```shell
yarn
yarn run dev:trigger
```

## Run Liquidator Bot
```shell
yarn
yarn run dev:liquidator
```

## Run JIT Maker Bot

âš  requires collateral

```shell
yarn
yarn run dev:jitmaker
```